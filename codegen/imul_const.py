
lo = lambda x: x & 0xff
hi = lambda x: (x & 0xffff) >> 8



def table(name, length, fn):
    if length % 256 != 0:
        raise ValueError("bad len")
    
    elems = [fn(i) for i in range(length)]
    elems_str = ','.join(str(e) for e in elems)
    
    return f"""const uint8_t {name}[{length}] = {{
    {elems_str}
}};
#pragma align({name}, 256)"""


def gen_imul_const():
    return f"""// generated by codegen.py
#include "imul.h"


#include <stdint.h>


#pragma code(code63)
#pragma data(data63)
#pragma bss(bss)

{table('sqrlo', 512, lambda i: lo(i**2 // 4))}
{table('sqrhi', 512, lambda i: hi(i**2 // 4))}


{table('negsqrlo', 512, lambda i: lo((255-i)**2 // 4))}
{table('negsqrhi', 512, lambda i: hi((255-i)**2 // 4))}
"""